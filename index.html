<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê³ í•™ ì˜µì…˜ ë½‘ê¸° ì‹œë®¬ë ˆì´í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .option-selectors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .option-selector-item {
            display: flex;
            flex-direction: column;
        }

        .option-selector-item label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .option-select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .option-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .probability-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }

        .probability-preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .probability-preview-item:last-child {
            margin-bottom: 0;
        }

        .preview-desc {
            flex: 1;
            font-weight: 600;
            color: #333;
        }

        .preview-percentage {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            min-width: 100px;
            text-align: right;
            margin-left: 20px;
        }

        .preview-weight {
            font-size: 0.9em;
            color: #999;
            margin-right: 15px;
        }

        .preview-detail {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        .preview-value-range {
            color: #666;
            margin-bottom: 5px;
        }

        .preview-weight-desc {
            color: #999;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .item-section {
            display: flex;
            align-items: center;
            gap: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .item-image-container {
            position: relative;
            width: 120px;
            height: 120px;
            flex-shrink: 0;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
            background: white;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .item-info {
            flex: 1;
        }

        .btn-large {
            padding: 18px 40px;
            font-size: 1.2em;
        }

        .enchant-results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .enchant-result-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .enchant-result-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .enchant-result-item.matched {
            border-color: #28a745;
            background: #f0fff4;
        }

        .match-info {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
        }

        .match-info h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .match-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .match-stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .match-stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .match-stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .item-section {
                flex-direction: column;
                text-align: center;
            }

            .enchant-results {
                grid-template-columns: 1fr;
            }
        
            .option-selectors {
                grid-template-columns: 1fr;
            }
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        button:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .stats-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        .results-section {
            margin-top: 30px;
        }

        .result-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .result-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .result-grade {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .grade-low {
            background: #d4edda;
            color: #155724;
        }

        .grade-mid {
            background: #fff3cd;
            color: #856404;
        }

        .grade-high {
            background: #f8d7da;
            color: #721c24;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .probability-chart {
            margin-top: 30px;
        }

        .chart-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .chart-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .chart-label {
            min-width: 200px;
            font-weight: 600;
            color: #333;
        }

        .chart-bar-container {
            flex: 1;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 0 15px;
            position: relative;
        }

        .chart-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }

        .chart-percentage {
            min-width: 80px;
            text-align: right;
            font-weight: 600;
            color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ê³ ê³ í•™ ì˜µì…˜ ë½‘ê¸° ì‹œë®¬ë ˆì´í„°</h1>
            <p>ì¸ê²Œì„ê³¼ ë™ì¼í•œ Weight ê¸°ë°˜ ëœë¤ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì˜µì…˜ì„ ë½‘ì•„ë³´ì„¸ìš”</p>
        </div>

        <div class="content">
            <!-- ì•„ì´í…œ ì´ë¯¸ì§€ ë° ê°ì •í•˜ê¸° ë²„íŠ¼ -->
            <div class="item-section">
                <div class="item-image-container">
                    <img src="icon_item_crystal_purple.png" alt="ê³ ê³ í•™ ì•„ì´í…œ" class="item-image">
                </div>
                <div class="item-info">
                    <h2 style="margin-bottom: 10px; color: #333;">ê³ ê³ í•™ ìœ ë¬¼</h2>
                    <p style="color: #666; margin-bottom: 20px;">ê°ì •í•˜ì—¬ ì˜µì…˜ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    <div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn-primary btn-large" onclick="rollOptions()" id="enchantBtn">âœ¨ ê°ì •í•˜ê¸°</button>
                        <button class="btn-secondary btn-large" onclick="toggleAutoEnchant()" id="autoEnchantBtn">ğŸ”„ ìë™ ê°ì •</button>
                    </div>
                    <div id="autoEnchantStatus" style="display: none; margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; color: #856404;">
                        <div style="font-weight: 600; margin-bottom: 5px;">ìë™ ê°ì • ì§„í–‰ ì¤‘...</div>
                        <div style="font-size: 0.9em;">ì‹œë„ íšŸìˆ˜: <span id="autoEnchantCount">0</span>íšŒ</div>
                    </div>
                </div>
            </div>

            <div class="control-panel">
                <div class="form-group">
                    <label>ì „ì‹œ ì•„ì´í…œ ì„ íƒ</label>
                    <select id="exhibitionItem" class="option-select">
                        <option value="">-- ì•„ì´í…œ ì„ íƒ --</option>
                    </select>
                    <small>ì „ì‹œ ì•„ì´í…œì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì•„ì´í…œì˜ ì˜µì…˜ í’€ì—ì„œ ì˜µì…˜ì´ ë½‘í™ë‹ˆë‹¤.</small>
                </div>

                <div class="form-group">
                    <label>ì›í•˜ëŠ” ì˜µì…˜ ì„ íƒ (ìµœëŒ€ 3ê°œ)</label>
                    <div class="option-selectors">
                        <div class="option-selector-item">
                            <label for="optionPool1">ì˜µì…˜ 1</label>
                            <select id="optionPool1" class="option-select">
                                <option value="">-- ì„ íƒ ì•ˆí•¨ --</option>
                            </select>
                        </div>
                        <div class="option-selector-item">
                            <label for="optionPool2">ì˜µì…˜ 2</label>
                            <select id="optionPool2" class="option-select">
                                <option value="">-- ì„ íƒ ì•ˆí•¨ --</option>
                            </select>
                        </div>
                        <div class="option-selector-item">
                            <label for="optionPool3">ì˜µì…˜ 3</label>
                            <select id="optionPool3" class="option-select">
                                <option value="">-- ì„ íƒ ì•ˆí•¨ --</option>
                            </select>
                        </div>
                    </div>
                    <small>ì›í•˜ëŠ” ì˜µì…˜ì„ ì„¤ëª…(Desc)ìœ¼ë¡œ ì„ íƒí•˜ì„¸ìš”. ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
                </div>

                <div class="form-group">
                    <label>ì„ íƒí•œ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œ ëª©ë¡</label>
                    <div id="selectedOptionsItemsList" class="probability-preview">
                        <p style="color: #666; text-align: center; padding: 20px;">ì˜µì…˜ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì´ ì•„ì´í…œì—ì„œ ë“±ì¥í•˜ëŠ” ì˜µì…˜ ëª©ë¡</label>
                    <div id="availableOptionsList" class="probability-preview">
                        <p style="color: #666; text-align: center; padding: 20px;">ì „ì‹œ ì•„ì´í…œì„ ì„ íƒí•˜ë©´ ë“±ì¥ ê°€ëŠ¥í•œ ì˜µì…˜ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì„ íƒí•œ ì˜µì…˜ ë“±ì¥ í™•ë¥ </label>
                    <div id="probabilityPreview" class="probability-preview">
                        <p style="color: #666; text-align: center; padding: 20px;">ì˜µì…˜ì„ ì„ íƒí•˜ë©´ í™•ë¥ ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>

            <!-- ê°ì • ê²°ê³¼ ì„¹ì…˜ -->
            <div class="result-section" id="resultSection" style="display: none;">
                <h2 style="margin-bottom: 20px; color: #333;">ê°ì • ê²°ê³¼</h2>
                <div id="enchantResults" class="enchant-results"></div>
                <div id="matchInfo" class="match-info"></div>
            </div>

            <div class="stats-panel">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalRolls">0</div>
                        <div class="stat-label">ì´ ë½‘ê¸° íšŸìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalOptions">0</div>
                        <div class="stat-label">ë½‘íŒ ì˜µì…˜ ìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="uniqueOptions">0</div>
                        <div class="stat-label">ê³ ìœ  ì˜µì…˜ ìˆ˜</div>
                    </div>
                </div>
            </div>

            <div class="results-section" style="display: none;">
                <h2 style="margin-bottom: 20px; color: #333;">ë½‘ê¸° ì´ë ¥</h2>
                <div id="resultsContainer">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6m0 4h.01"/>
                        </svg>
                        <p>ê°ì • ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                    </div>
                </div>
            </div>

            <div class="probability-chart" id="probabilityChart" style="display: none;">
                <div class="chart-title">ì˜µì…˜ë³„ ë“±ì¥ í™•ë¥  í†µê³„</div>
                <div id="chartContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì‹œ ì•„ì´í…œ ë°ì´í„° (archeology_exhibition_item.ies)
        const EXHIBITION_ITEMS = [
            {ClassID: 6, cost: 3, OptionCount: 1, ClassName: "Arc_Klaipeda_Ancient_Lamp", Name: "[ê³ ê³ í•™] ê³ ëŒ€ í¬ë¦¬ìŠ¤íƒˆ ë¨í”„", OptionPool: "1;2;4;5;7;8;10;11"},
            {ClassID: 7, cost: 4, OptionCount: 2, ClassName: "Arc_Klaipeda_Gele_Totem", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ë¶€ì¡± í† í…œ", OptionPool: "2;3;5;6;8;9;11;12;16;17;19;20"},
            {ClassID: 8, cost: 5, OptionCount: 2, ClassName: "Arc_Orsha_Royal_Seal", Name: "[ê³ ê³ í•™] ì™•ì‹¤ ì¸ì¥", OptionPool: "3;6;9;12;15;18;21;24"},
            {ClassID: 9, cost: 3, OptionCount: 1, ClassName: "Arc_Fedimian_War_Helm", Name: "[ê³ ê³ í•™] ë¡œì¹´ìŠ¤ íˆ¬êµ¬", OptionPool: "1;4;7;10;13;16;19;22"},
            {ClassID: 10, cost: 4, OptionCount: 2, ClassName: "Arc_Fedimian_Holy_Relic", Name: "[ê³ ê³ í•™] ë‚˜ëª¨íŠ¸ ì„±ìœ ë¬¼", OptionPool: "2;5;8;11;14;17;20;23"},
            {ClassID: 11, cost: 4, OptionCount: 2, ClassName: "Arc_Forest_Spirit_Stone", Name: "[ê³ ê³ í•™] ì •ë ¹ì˜ ìˆ¨ê²°ì„", OptionPool: "1;2;3;7;8;9;10;11;12;16;17;18"},
            {ClassID: 12, cost: 3, OptionCount: 1, ClassName: "Arc_Kallis_Monolith", Name: "[ê³ ê³ í•™] ëŒ€ì§€ì˜ ë¹„ì„ ì¡°ê°", OptionPool: "4;5;6;10;11;12;13;14;15"},
            {ClassID: 13, cost: 5, OptionCount: 3, ClassName: "Arc_Starry_Astrolabe", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì²œì²´ ê´€ì¸¡ê¸°", OptionPool: "3;6;9;12;15;18;21;24"},
            {ClassID: 14, cost: 4, OptionCount: 2, ClassName: "Arc_Royal_Sword", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì˜ë¡€ìš© ê²€", OptionPool: "2;3;5;6;8;9;11;12;14;15;17;18;20;21;23;24"},
            {ClassID: 15, cost: 5, OptionCount: 3, ClassName: "Arc_Ashaq_Grimoire", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ë§ˆë²•ì„œ", OptionPool: "1;2;3;4;5;6;7;8;9;10;11;12;13;14;15;16;17;18;19;20;21;22;23;24"},
            {ClassID: 16, cost: 6, OptionCount: 2, ClassName: "Arc_Saule_Golden_Crown", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì™•ê´€", OptionPool: "6;9;12;15;18;21;24;27;30;33"},
            {ClassID: 17, cost: 4, OptionCount: 2, ClassName: "Arc_Saule_Holy_Chalice", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì–´ê¹¨ ë°©ì–´êµ¬", OptionPool: "8;9;11;12;16;17;18;26;29;32;43;44"},
            {ClassID: 18, cost: 3, OptionCount: 1, ClassName: "Arc_Dina_Bee_Spirit_Mask", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì •ë ¹ì˜ ê°€ë©´", OptionPool: "1;2;4;5;7;8;10;11"},
            {ClassID: 19, cost: 3, OptionCount: 1, ClassName: "Arc_Dina_Bee_Crystal", Name: "[ê³ ê³ í•™] ê³ ëŒ€ì˜ ê¿€", OptionPool: "1;2;4;5;7;8;22;23"},
            {ClassID: 20, cost: 7, OptionCount: 3, ClassName: "Arc_Vakarine_Moon_Shield", Name: "[ê³ ê³ í•™] ë‹¬ë¹› ìˆ˜í˜¸ìì˜ ë°©íŒ¨", OptionPool: "9;12;15;18;21;24;27;30;33;39;42;48"},
            {ClassID: 21, cost: 5, OptionCount: 2, ClassName: "Arc_Vakarine_Goddess_Statue", Name: "[ê³ ê³ í•™] ê¸ˆì´ ê°„ ì—¬ì‹ ìƒ", OptionPool: "8;9;11;12;14;15;17;18;20;21;23;24;26;29;32;38;41;44"},
            {ClassID: 22, cost: 4, OptionCount: 2, ClassName: "Arc_Siaulai_Druid_Staff", Name: "[ê³ ê³ í•™] ë“œë£¨ì´ë“œì˜ ì§€íŒ¡ì´", OptionPool: "2;3;5;6;11;12;14;15;19;20;21"},
            {ClassID: 23, cost: 3, OptionCount: 1, ClassName: "Arc_Siaulai_Nature_Stone", Name: "[ê³ ê³ í•™] ìì—°ì˜ ìˆ˜í˜¸ì„", OptionPool: "1;2;4;5;10;11;13;14"},
            {ClassID: 24, cost: 3, OptionCount: 1, ClassName: "Arc_Tenet_Flower_Fossil", Name: "[ê³ ê³ í•™] ì—¬ì‹ ì˜ ê½ƒ í™”ì„", OptionPool: "1;2;4;5;7;8;16;17;22;23"},
            {ClassID: 25, cost: 4, OptionCount: 2, ClassName: "Arc_Tenet_Eternal_Wood", Name: "[ê³ ê³ í•™] ì˜¤ë˜ëœ ë‚˜ë¬´ ì¡°ê°", OptionPool: "2;3;5;6;11;12;13;14;15;16;17;18"},
            {ClassID: 26, cost: 3, OptionCount: 1, ClassName: "Arc_Lemprasa_Iron_Axe", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ë¶€ì¡±ì˜ ë„ë¼", OptionPool: "1;2;4;5;10;11;19;20"},
            {ClassID: 27, cost: 2, OptionCount: 1, ClassName: "Arc_Lemprasa_Miner_Hammer", Name: "[ê³ ê³ í•™] ê´‘ì‚° ë…¸ë™ìì˜ ë§ì¹˜", OptionPool: "1;4;7;10;13;16;19;22"},
            {ClassID: 28, cost: 4, OptionCount: 2, ClassName: "Arc_Tantra_Warrior_Sword", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì „ì‚¬ì˜ ê²€", OptionPool: "2;3;5;6;8;9;16;17;18;22;23;24;26;29;35;38;44;53"},
            {ClassID: 29, cost: 3, OptionCount: 1, ClassName: "Arc_Tantra_Battle_Banner", Name: "[ê³ ê³ í•™] ì „íˆ¬ì˜ ê¹ƒë°œ ì¡°ê°", OptionPool: "1;2;4;5;7;8;10;11;22;23;25;28;31;37;40"},
            {ClassID: 30, cost: 3, OptionCount: 1, ClassName: "Arc_Manor_Pocket_Watch", Name: "[ê³ ê³ í•™] ì†ìƒëœ íšŒì¤‘ì‹œê³„", OptionPool: "1;2;4;5;13;14;19;20"},
            {ClassID: 31, cost: 5, OptionCount: 2, ClassName: "Arc_Manor_Ornate_Mirror", Name: "[ê³ ê³ í•™] ê±°ìš¸ ì¡°ê°", OptionPool: "2;3;5;6;8;9;11;12;14;15;17;18;20;21;23;24;38;41;50"},
            {ClassID: 32, cost: 3, OptionCount: 1, ClassName: "Arc_Train_Steam_Part", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ê¸°ê´€ ë¶€í’ˆ", OptionPool: "1;2;4;5;10;11;19;20"},
            {ClassID: 33, cost: 4, OptionCount: 2, ClassName: "Arc_Train_Clock_Device", Name: "[ê³ ê³ í•™] ê³ ëŒ€ ì‹œê³„ ì¥ì¹˜", OptionPool: "2;3;5;6;8;9;11;12;16;17;18;19;20;21"},
            {ClassID: 34, cost: 5, OptionCount: 2, ClassName: "Arc_Alchemist_Flask", Name: "[ê³ ê³ í•™] ì—°ê¸ˆìˆ ì‚¬ì˜ í”Œë¼ìŠ¤í¬", OptionPool: "2;3;5;6;8;9;10;11;12;16;17;18;26;32;44;47"},
            {ClassID: 35, cost: 6, OptionCount: 3, ClassName: "Arc_Alchemist_Crystal", Name: "[ê³ ê³ í•™] ë§ˆë²• ì¦í­ ìˆ˜ì •", OptionPool: "3;6;9;12;15;18;21;24;27;30;33;36;39;42;45;48;51;54"}
        ];

        // ê³ ê³ í•™ ì˜µì…˜ ë°ì´í„° (archeology_option_list.ies)
        const OPTION_DATA = [
            {ClassID: 1, Grade: 1, Weight: 100, MinValue: 1, MaxValue: 3, ClassName: "COIN_GAIN_LOW", Type: "Effect", Stat: "ARCHEOLOGY_COIN_GAIN", Desc: "ì¼ë°˜ ìœ ë¬¼ ì¶”ê°€ íšë“ í™•ë¥ "},
            {ClassID: 2, Grade: 2, Weight: 60, MinValue: 3, MaxValue: 7, ClassName: "COIN_GAIN_MID", Type: "Effect", Stat: "ARCHEOLOGY_COIN_GAIN", Desc: "ì¼ë°˜ ìœ ë¬¼ ì¶”ê°€ íšë“ í™•ë¥ "},
            {ClassID: 3, Grade: 3, Weight: 35, MinValue: 7, MaxValue: 12, ClassName: "COIN_GAIN_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_COIN_GAIN", Desc: "ì¼ë°˜ ìœ ë¬¼ ì¶”ê°€ íšë“ í™•ë¥ "},
            {ClassID: 4, Grade: 1, Weight: 100, MinValue: 10, MaxValue: 30, ClassName: "DETECT_RANGE_LOW", Type: "Effect", Stat: "ARCHEOLOGY_DETECTING", Desc: "íƒì§€ê¸° ìœ íš¨ ë²”ìœ„ ì¦ê°€"},
            {ClassID: 5, Grade: 2, Weight: 60, MinValue: 30, MaxValue: 70, ClassName: "DETECT_RANGE_MID", Type: "Effect", Stat: "ARCHEOLOGY_DETECTING", Desc: "íƒì§€ê¸° ìœ íš¨ ë²”ìœ„ ì¦ê°€"},
            {ClassID: 6, Grade: 3, Weight: 35, MinValue: 70, MaxValue: 120, ClassName: "DETECT_RANGE_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_DETECTING", Desc: "íƒì§€ê¸° ìœ íš¨ ë²”ìœ„ ì¦ê°€"},
            {ClassID: 7, Grade: 1, Weight: 100, MinValue: 3, MaxValue: 7, ClassName: "RARE_FIND_LOW", Type: "Effect", Stat: "ARCHEOLOGY_RARE_CHANCE", Desc: "ë°œêµ´ ì‹œ í¬ê·€ ìœ ë¬¼ ë°œê²¬ í™•ë¥  ì¦ê°€ (%)"},
            {ClassID: 8, Grade: 2, Weight: 60, MinValue: 7, MaxValue: 15, ClassName: "RARE_FIND_MID", Type: "Effect", Stat: "ARCHEOLOGY_RARE_CHANCE", Desc: "ë°œêµ´ ì‹œ í¬ê·€ ìœ ë¬¼ ë°œê²¬ í™•ë¥  ì¦ê°€ (%)"},
            {ClassID: 9, Grade: 3, Weight: 35, MinValue: 15, MaxValue: 25, ClassName: "RARE_FIND_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_RARE_CHANCE", Desc: "ë°œêµ´ ì‹œ í¬ê·€ ìœ ë¬¼ ë°œê²¬ í™•ë¥  ì¦ê°€ (%)"},
            {ClassID: 10, Grade: 1, Weight: 100, MinValue: 5, MaxValue: 10, ClassName: "QUALITY_UP_LOW", Type: "Effect", Stat: "ARCHEOLOGY_QUALITY_BONUS", Desc: "ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ìœ ë¬¼ ìƒíƒœ ë“±ê¸‰ í–¥ìƒ í™•ë¥  (%)"},
            {ClassID: 11, Grade: 2, Weight: 60, MinValue: 10, MaxValue: 20, ClassName: "QUALITY_UP_MID", Type: "Effect", Stat: "ARCHEOLOGY_QUALITY_BONUS", Desc: "ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ìœ ë¬¼ ìƒíƒœ ë“±ê¸‰ í–¥ìƒ í™•ë¥  (%)"},
            {ClassID: 12, Grade: 3, Weight: 35, MinValue: 20, MaxValue: 35, ClassName: "QUALITY_UP_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_QUALITY_BONUS", Desc: "ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ìœ ë¬¼ ìƒíƒœ ë“±ê¸‰ í–¥ìƒ í™•ë¥  (%)"},
            {ClassID: 13, Grade: 1, Weight: 100, MinValue: 5, MaxValue: 10, ClassName: "EXP_BONUS_LOW", Type: "Effect", Stat: "ARCHEOLOGY_SPECIAL_REWARD", Desc: "ê³ ëŒ€ì¸ì˜ ìœ ì‹¤ë¬¼ ìˆ˜ëŸ‰ ì¦ê°€ë¥  (%)"},
            {ClassID: 14, Grade: 2, Weight: 60, MinValue: 10, MaxValue: 20, ClassName: "EXP_BONUS_MID", Type: "Effect", Stat: "ARCHEOLOGY_SPECIAL_REWARD", Desc: "ê³ ëŒ€ì¸ì˜ ìœ ì‹¤ë¬¼ ìˆ˜ëŸ‰ ì¦ê°€ë¥  (%)"},
            {ClassID: 15, Grade: 3, Weight: 35, MinValue: 20, MaxValue: 40, ClassName: "EXP_BONUS_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_SPECIAL_REWARD", Desc: "ê³ ëŒ€ì¸ì˜ ìœ ì‹¤ë¬¼ ìˆ˜ëŸ‰ ì¦ê°€ë¥  (%)"},
            {ClassID: 16, Grade: 1, Weight: 100, MinValue: 1, MaxValue: 2, ClassName: "CRITICAL_DIG_LOW", Type: "Effect", Stat: "ARCHEOLOGY_CRITICAL_CHANCE", Desc: "í¬ë¦¬í‹°ì»¬ ë°œêµ´ í™•ë¥  - ë³´ìƒ 2ë°° (%)"},
            {ClassID: 17, Grade: 2, Weight: 60, MinValue: 2, MaxValue: 3, ClassName: "CRITICAL_DIG_MID", Type: "Effect", Stat: "ARCHEOLOGY_CRITICAL_CHANCE", Desc: "í¬ë¦¬í‹°ì»¬ ë°œêµ´ í™•ë¥  - ë³´ìƒ 2ë°° (%)"},
            {ClassID: 18, Grade: 3, Weight: 35, MinValue: 3, MaxValue: 5, ClassName: "CRITICAL_DIG_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_CRITICAL_CHANCE", Desc: "í¬ë¦¬í‹°ì»¬ ë°œêµ´ í™•ë¥  - ë³´ìƒ 2ë°° (%)"},
            {ClassID: 19, Grade: 1, Weight: 60, MinValue: 1, MaxValue: 2, ClassName: "DIG_COUNT_LOW", Type: "Effect", Stat: "ARCHEOLOGY_MON_FIND", Desc: "ëª¬ìŠ¤í„° ë°œê²¬ í™•ë¥  ì¦ê°€"},
            {ClassID: 20, Grade: 2, Weight: 30, MinValue: 2, MaxValue: 4, ClassName: "DIG_COUNT_MID", Type: "Effect", Stat: "ARCHEOLOGY_MON_FIND", Desc: "ëª¬ìŠ¤í„° ë°œê²¬ í™•ë¥  ì¦ê°€"},
            {ClassID: 21, Grade: 3, Weight: 15, MinValue: 4, MaxValue: 6, ClassName: "DIG_COUNT_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_MON_FIND", Desc: "ëª¬ìŠ¤í„° ë°œê²¬ í™•ë¥  ì¦ê°€"},
            {ClassID: 22, Grade: 1, Weight: 100, MinValue: 5, MaxValue: 10, ClassName: "DOUBLE_DROP_LOW", Type: "Effect", Stat: "ARCHEOLOGY_DOUBLE_DROP", Desc: "ì²˜ì¹˜ ì‹œ ì¶”ê°€ ìœ ë¬¼ ë™ì‹œ íšë“ í™•ë¥  (%)"},
            {ClassID: 23, Grade: 2, Weight: 60, MinValue: 10, MaxValue: 20, ClassName: "DOUBLE_DROP_MID", Type: "Effect", Stat: "ARCHEOLOGY_DOUBLE_DROP", Desc: "ì²˜ì¹˜ ì‹œ ì¶”ê°€ ìœ ë¬¼ ë™ì‹œ íšë“ í™•ë¥  (%)"},
            {ClassID: 24, Grade: 3, Weight: 35, MinValue: 20, MaxValue: 35, ClassName: "DOUBLE_DROP_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_DOUBLE_DROP", Desc: "ì²˜ì¹˜ ì‹œ ì¶”ê°€ ìœ ë¬¼ ë™ì‹œ íšë“ í™•ë¥  (%)"},
            {ClassID: 25, Grade: 1, Weight: 90, MinValue: 5000, MaxValue: 10000, ClassName: "HP_BONUS_LOW", Type: "Stat", Stat: "ARCHEOLOGY_HP_BONUS", Desc: "ìµœëŒ€ HP ì¦ê°€"},
            {ClassID: 26, Grade: 2, Weight: 50, MinValue: 10000, MaxValue: 15000, ClassName: "HP_BONUS_MID", Type: "Stat", Stat: "ARCHEOLOGY_HP_BONUS", Desc: "ìµœëŒ€ HP ì¦ê°€"},
            {ClassID: 27, Grade: 3, Weight: 25, MinValue: 15000, MaxValue: 20000, ClassName: "HP_BONUS_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_HP_BONUS", Desc: "ìµœëŒ€ HP ì¦ê°€"},
            {ClassID: 28, Grade: 1, Weight: 90, MinValue: 500, MaxValue: 2000, ClassName: "DEF_BONUS_LOW", Type: "Stat", Stat: "ARCHEOLOGY_DEF_BONUS", Desc: "ë¬¼ë¦¬ ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 29, Grade: 2, Weight: 50, MinValue: 2000, MaxValue: 3000, ClassName: "DEF_BONUS_MID", Type: "Stat", Stat: "ARCHEOLOGY_DEF_BONUS", Desc: "ë¬¼ë¦¬ ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 30, Grade: 3, Weight: 25, MinValue: 3000, MaxValue: 4000, ClassName: "DEF_BONUS_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_DEF_BONUS", Desc: "ë¬¼ë¦¬ ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 31, Grade: 1, Weight: 90, MinValue: 500, MaxValue: 2000, ClassName: "MDEF_BONUS_LOW", Type: "Stat", Stat: "ARCHEOLOGY_MDEF_BONUS", Desc: "ë§ˆë²• ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 32, Grade: 2, Weight: 50, MinValue: 2000, MaxValue: 3000, ClassName: "MDEF_BONUS_MID", Type: "Stat", Stat: "ARCHEOLOGY_MDEF_BONUS", Desc: "ë§ˆë²• ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 33, Grade: 3, Weight: 25, MinValue: 3000, MaxValue: 4000, ClassName: "MDEF_BONUS_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_MDEF_BONUS", Desc: "ë§ˆë²• ë°©ì–´ë ¥ ì¦ê°€"},
            {ClassID: 34, Grade: 1, Weight: 100, MinValue: 0.5, MaxValue: 1.5, ClassName: "MON_DROP_RATE_LOW", Type: "Effect", Stat: "ARCHEOLOGY_MON_DROP_RATE", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ì•„ì´í…œ ë“œë¡­ë¥  ì¦ê°€ (%)"},
            {ClassID: 35, Grade: 2, Weight: 60, MinValue: 1.5, MaxValue: 3.5, ClassName: "MON_DROP_RATE_MID", Type: "Effect", Stat: "ARCHEOLOGY_MON_DROP_RATE", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ì•„ì´í…œ ë“œë¡­ë¥  ì¦ê°€ (%)"},
            {ClassID: 36, Grade: 3, Weight: 35, MinValue: 3.5, MaxValue: 7.5, ClassName: "MON_DROP_RATE_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_MON_DROP_RATE", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ ì•„ì´í…œ ë“œë¡­ë¥  ì¦ê°€ (%)"},
            {ClassID: 37, Grade: 1, Weight: 90, MinValue: 10, MaxValue: 30, ClassName: "DODGE_BONUS_LOW", Type: "Stat", Stat: "ARCHEOLOGY_DODGE", Desc: "íšŒí”¼ ì¦ê°€"},
            {ClassID: 38, Grade: 2, Weight: 50, MinValue: 30, MaxValue: 70, ClassName: "DODGE_BONUS_MID", Type: "Stat", Stat: "ARCHEOLOGY_DODGE", Desc: "íšŒí”¼ ì¦ê°€"},
            {ClassID: 39, Grade: 3, Weight: 25, MinValue: 70, MaxValue: 150, ClassName: "DODGE_BONUS_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_DODGE", Desc: "íšŒí”¼ ì¦ê°€"},
            {ClassID: 40, Grade: 1, Weight: 90, MinValue: 15, MaxValue: 45, ClassName: "CRIT_RES_LOW", Type: "Stat", Stat: "ARCHEOLOGY_CRIT_RES", Desc: "í¬ë¦¬í‹°ì»¬ ì €í•­ ì¦ê°€"},
            {ClassID: 41, Grade: 2, Weight: 50, MinValue: 45, MaxValue: 105, ClassName: "CRIT_RES_MID", Type: "Stat", Stat: "ARCHEOLOGY_CRIT_RES", Desc: "í¬ë¦¬í‹°ì»¬ ì €í•­ ì¦ê°€"},
            {ClassID: 42, Grade: 3, Weight: 25, MinValue: 105, MaxValue: 225, ClassName: "CRIT_RES_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_CRIT_RES", Desc: "í¬ë¦¬í‹°ì»¬ ì €í•­ ì¦ê°€"},
            {ClassID: 43, Grade: 1, Weight: 90, MinValue: 0.5, MaxValue: 1, ClassName: "HP_RECOVER_ON_KILL_LOW", Type: "Effect", Stat: "ARCHEOLOGY_HP_ON_KILL", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ HP íšŒë³µ (%)"},
            {ClassID: 44, Grade: 2, Weight: 50, MinValue: 1, MaxValue: 2, ClassName: "HP_RECOVER_ON_KILL_MID", Type: "Effect", Stat: "ARCHEOLOGY_HP_ON_KILL", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ HP íšŒë³µ (%)"},
            {ClassID: 45, Grade: 3, Weight: 25, MinValue: 2, MaxValue: 4, ClassName: "HP_RECOVER_ON_KILL_HIGH", Type: "Effect", Stat: "ARCHEOLOGY_HP_ON_KILL", Desc: "ê³ ê³ í•™ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì‹œ HP íšŒë³µ (%)"},
            {ClassID: 46, Grade: 2, Weight: 15, MinValue: 1, MaxValue: 4, ClassName: "DMG_REDUCE", Type: "Stat", Stat: "ARCHEOLOGY_DMG_REDUCE", Desc: "ë°›ëŠ” ë°ë¯¸ì§€ ê°ì†Œ (%)"},
            {ClassID: 47, Grade: 1, Weight: 80, MinValue: 1, MaxValue: 1, ClassName: "MOVE_SPEED_LOW", Type: "Stat", Stat: "ARCHEOLOGY_MOVE_SPEED", Desc: "ì´ë™ ì†ë„ ì¦ê°€"},
            {ClassID: 48, Grade: 2, Weight: 40, MinValue: 2, MaxValue: 2, ClassName: "MOVE_SPEED_MID", Type: "Stat", Stat: "ARCHEOLOGY_MOVE_SPEED", Desc: "ì´ë™ ì†ë„ ì¦ê°€"},
            {ClassID: 49, Grade: 3, Weight: 15, MinValue: 3, MaxValue: 3, ClassName: "MOVE_SPEED_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_MOVE_SPEED", Desc: "ì´ë™ ì†ë„ ì¦ê°€"},
            {ClassID: 50, Grade: 1, Weight: 90, MinValue: 25, MaxValue: 75, ClassName: "BLOCK_PEN_LOW", Type: "Stat", Stat: "ARCHEOLOGY_BLOCK_PEN", Desc: "ë¸”ë¡ ê´€í†µ ì¦ê°€"},
            {ClassID: 51, Grade: 2, Weight: 50, MinValue: 75, MaxValue: 175, ClassName: "BLOCK_PEN_MID", Type: "Stat", Stat: "ARCHEOLOGY_BLOCK_PEN", Desc: "ë¸”ë¡ ê´€í†µ ì¦ê°€"},
            {ClassID: 52, Grade: 3, Weight: 25, MinValue: 175, MaxValue: 350, ClassName: "BLOCK_PEN_HIGH", Type: "Stat", Stat: "ARCHEOLOGY_BLOCK_PEN", Desc: "ë¸”ë¡ ê´€í†µ ì¦ê°€"}
        ];

        // í†µê³„ ë°ì´í„°
        let stats = {
            totalRolls: 0,
            optionCounts: {},
            optionValueSum: {},
            optionValueCount: {}
        };

        // ìë™ ê°ì • ê´€ë ¨ ë³€ìˆ˜
        let autoEnchantInterval = null;
        let autoEnchantCount = 0;
        let isAutoEnchanting = false;

        // IMCRandom í•¨ìˆ˜ (ì¸ê²Œì„ê³¼ ë™ì¼í•œ ë¡œì§)
        // min ì´ìƒ max ì´í•˜ì˜ ì •ìˆ˜ ë°˜í™˜
        function IMCRandom(min, max) {
            min = Math.floor(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // IMCRandomFloat í•¨ìˆ˜ (ì¸ê²Œì„ê³¼ ë™ì¼í•œ ë¡œì§)
        // min ì´ìƒ max ë¯¸ë§Œì˜ ì‹¤ìˆ˜ ë°˜í™˜ (ì¼ë°˜ì ì¸ ì‹¤ìˆ˜ ëœë¤ ë²”ìœ„)
        // ë‹¨, ê²Œì„ì—ì„œ maxë¥¼ í¬í•¨í•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ maxë„ í¬í•¨í•˜ë„ë¡ êµ¬í˜„
        function IMCRandomFloat(min, max) {
            // Luaì˜ IMCRandomFloatëŠ” ë³´í†µ min ì´ìƒ max ë¯¸ë§Œì´ì§€ë§Œ,
            // ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œë¥¼ ë³´ë©´ maxë„ í¬í•¨í•  ìˆ˜ ìˆìŒ
            // ì•ˆì „í•˜ê²Œ maxë¥¼ í¬í•¨í•˜ë„ë¡ êµ¬í˜„ (ì‹¤ì œ ê²Œì„ ë™ì‘ í™•ì¸ í•„ìš”)
            return Math.random() * (max - min) + min;
        }

        // ì •ìˆ˜ ì²´í¬ í•¨ìˆ˜ (Luaì˜ isIntegerì™€ ë™ì¼)
        function isInteger(n) {
            // ìˆ«ìê°€ ì•„ë‹ˆë©´ false
            if (typeof n !== 'number') return false;
            // NaN ì²´í¬
            if (isNaN(n)) return false;
            // 1ë¡œ ë‚˜ëˆ„ì—ˆì„ ë•Œ ë‚˜ë¨¸ì§€ê°€ 0ì´ë©´ ì •ìˆ˜
            return n % 1 === 0;
        }

        // ì¸ê²Œì„ê³¼ ë™ì¼í•œ Weight ê¸°ë°˜ ëœë¤ ì„ íƒ ì•Œê³ ë¦¬ì¦˜
        // calc_weight_base_random í•¨ìˆ˜ë¥¼ ì •í™•íˆ ì¬í˜„
        function calcWeightBaseRandom(pools, pickcount) {
            const weightlist = [];
            const results = [];

            // ê° ì˜µì…˜ì— ëŒ€í•´ U = random(0, 1), V = U^(1/Weight) ê³„ì‚°
            for (let i = 0; i < pools.length; i++) {
                const opt_data = pools[i];
                const Weight = opt_data.weight;
                let U = IMCRandomFloat(0, 1);
                
                // Uê°€ 0 ì´í•˜ë©´ 0.00001ë¡œ ì„¤ì •
                if (U <= 0) {
                    U = 0.00001;
                }
                
                // V = U^(1/Weight)
                const V = Math.pow(U, 1 / Weight);

                weightlist.push({
                    id: opt_data.id,
                    cls: opt_data.cls,
                    weight: V
                });
            }

            // V ê°’ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            weightlist.sort((a, b) => b.weight - a.weight);

            // ìƒìœ„ Nê°œ ì„ íƒ (Lua ì½”ë“œì™€ ë™ì¼: i > pickcountì´ë©´ break)
            for (let i = 0; i < weightlist.length; i++) {
                if (i >= pickcount) {
                    break;
                }
                
                const opt_data = weightlist[i];
                
                // ìˆ˜ì¹˜ ë¡¤ë§ (Lua ì½”ë“œì™€ ì •í™•íˆ ë™ì¼í•œ ë¡œì§)
                // Lua: local rolled_value = IMCRandom(min_val, max_val)
                //      if not isInteger(min_val) or not isInteger(max_val) then
                //          rolled_value = IMCRandomFloat(min_val, max_val)
                //      end
                const min_val = opt_data.cls.MinValue;
                const max_val = opt_data.cls.MaxValue;
                let rolled_value;
                
                // Lua ì½”ë“œ ìˆœì„œ ê·¸ëŒ€ë¡œ: ë¨¼ì € IMCRandom í˜¸ì¶œ
                rolled_value = IMCRandom(min_val, max_val);
                
                // ì •ìˆ˜ê°€ ì•„ë‹ˆë©´ IMCRandomFloat ì‚¬ìš© (Lua ì½”ë“œì™€ ë™ì¼)
                if (!isInteger(min_val) || !isInteger(max_val)) {
                    rolled_value = IMCRandomFloat(min_val, max_val);
                }

                results.push([opt_data.id, rolled_value]);
            }

            return results;
        }

        // í˜„ì¬ ì„ íƒëœ ì•„ì´í…œì˜ ì˜µì…˜ í’€ ê°€ì ¸ì˜¤ê¸°
        function getCurrentItemOptionPool() {
            const itemSelect = document.getElementById('exhibitionItem');
            const selectedItemId = itemSelect.value;
            
            if (!selectedItemId || selectedItemId === '') {
                // ì•„ì´í…œì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì „ì²´ ì˜µì…˜ í’€ ë°˜í™˜
                return OPTION_DATA.filter(opt => opt.Weight > 0);
            }
            
            const selectedItem = EXHIBITION_ITEMS.find(item => item.ClassID.toString() === selectedItemId);
            if (!selectedItem) {
                return OPTION_DATA.filter(opt => opt.Weight > 0);
            }
            
            // OptionPool íŒŒì‹± (ì„¸ë¯¸ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„ëœ ì˜µì…˜ IDë“¤)
            const optionIds = selectedItem.OptionPool.split(';').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
            
            // í•´ë‹¹ IDë“¤ì— í•´ë‹¹í•˜ëŠ” ì˜µì…˜ë“¤ë§Œ í•„í„°ë§
            return OPTION_DATA.filter(opt => optionIds.includes(opt.ClassID) && opt.Weight > 0);
        }

        // í˜„ì¬ ì„ íƒëœ ì•„ì´í…œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getCurrentItem() {
            const itemSelect = document.getElementById('exhibitionItem');
            const selectedItemId = itemSelect.value;
            
            if (!selectedItemId || selectedItemId === '') {
                return null;
            }
            
            return EXHIBITION_ITEMS.find(item => item.ClassID.toString() === selectedItemId);
        }

        // ì„ íƒëœ ì˜µì…˜ë“¤ì˜ í™•ë¥  ê³„ì‚°
        function calculateProbabilities() {
            const currentItem = getCurrentItem();
            
            const selectedDescs = [];
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                const selectedDesc = select.value;
                if (selectedDesc && selectedDesc !== '') {
                    selectedDescs.push(selectedDesc);
                }
            }

            if (selectedDescs.length === 0) {
                document.getElementById('probabilityPreview').innerHTML = 
                    '<p style="color: #666; text-align: center; padding: 20px;">ì˜µì…˜ì„ ì„ íƒí•˜ë©´ í™•ë¥ ì´ í‘œì‹œë©ë‹ˆë‹¤</p>';
                return null;
            }
            
            if (!currentItem) {
                document.getElementById('probabilityPreview').innerHTML = 
                    '<p style="color: #666; text-align: center; padding: 20px;">ì „ì‹œ ì•„ì´í…œì„ ì„ íƒí•˜ë©´ ì„ íƒí•œ ì˜µì…˜ì˜ ë“±ì¥ í™•ë¥ ì´ í‘œì‹œë©ë‹ˆë‹¤</p>';
                return null;
            }

            if (selectedDescs.length === 0) {
                document.getElementById('probabilityPreview').innerHTML = 
                    '<p style="color: #666; text-align: center; padding: 20px;">ì˜µì…˜ì„ ì„ íƒí•˜ë©´ í™•ë¥ ì´ í‘œì‹œë©ë‹ˆë‹¤</p>';
                return null;
            }

            // í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ ì‚¬ìš©
            const currentOptionPool = getCurrentItemOptionPool();
            const optionCount = currentItem.OptionCount;

            // í˜„ì¬ ì˜µì…˜ í’€ì˜ Weight í•©ê³„
            const totalWeight = currentOptionPool.reduce((sum, opt) => sum + (opt.Weight > 0 ? opt.Weight : 0), 0);

            // ê° Descë³„ë¡œ Weight í•©ì‚° (í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ì—ì„œë§Œ)
            const descWeights = {};
            for (const desc of selectedDescs) {
                const options = currentOptionPool.filter(opt => opt.Desc === desc);
                const totalDescWeight = options.reduce((sum, opt) => sum + opt.Weight, 0);
                descWeights[desc] = totalDescWeight;
            }

            const totalSelectedWeight = Object.values(descWeights).reduce((sum, weight) => sum + weight, 0);

            // ê°ì • ì‹œ Nê°œ ì˜µì…˜ì´ ë‚˜ì˜¬ ë•Œ, ì„ íƒí•œ ì˜µì…˜ì´ í•˜ë‚˜ë¼ë„ í¬í•¨ë  í™•ë¥ 
            const noMatchProb = Math.pow((totalWeight - totalSelectedWeight) / totalWeight, optionCount);
            const atLeastOneMatchProb = (1 - noMatchProb) * 100;

            // ì„ íƒí•œ ì˜µì…˜ì´ ëª¨ë‘ ë‚˜ì˜¬ í™•ë¥  ê³„ì‚°
            // 3ê°œ ì˜µì…˜ ì¤‘ì—ì„œ ì„ íƒí•œ ì˜µì…˜ë“¤ì´ ëª¨ë‘ í¬í•¨ë  í™•ë¥ 
            // Weight ê¸°ë°˜ ëœë¤ì´ë¯€ë¡œ ê° ì˜µì…˜ì˜ Weight ë¹„ìœ¨ë¡œ ê³„ì‚°
            let allMatchProb = 0;
            if (selectedDescs.length > 0 && selectedDescs.length <= 3) {
                // ê° ì„ íƒí•œ ì˜µì…˜ì´ ë‚˜ì˜¬ í™•ë¥  (Weight ë¹„ìœ¨)
                const individualProbs = selectedDescs.map(desc => {
                    const weight = descWeights[desc];
                    return weight / totalWeight;
                });

                // 3ê°œë¥¼ ë½‘ì„ ë•Œ ì„ íƒí•œ ì˜µì…˜ë“¤ì´ ëª¨ë‘ í¬í•¨ë  í™•ë¥ 
                // ê·¼ì‚¬ì¹˜ ê³„ì‚° (ì‹¤ì œë¡œëŠ” ë³µì¡í•œ ì¡°í•© í™•ë¥ ì´ì§€ë§Œ, ê°„ë‹¨í•œ ê·¼ì‚¬ì¹˜ ì‚¬ìš©)
                if (selectedDescs.length === 1) {
                    // 1ê°œ ì„ íƒ: 3ê°œ ì¤‘ ìµœì†Œ 1ê°œê°€ ì„ íƒí•œ ì˜µì…˜ì¼ í™•ë¥  (ì´ë¯¸ atLeastOneMatchProbì— í¬í•¨)
                    allMatchProb = atLeastOneMatchProb;
                } else if (selectedDescs.length === 2) {
                    // 2ê°œ ì„ íƒ: Nê°œ ì¤‘ 2ê°œê°€ ì„ íƒí•œ ì˜µì…˜ë“¤ì¼ í™•ë¥ 
                    // ê·¼ì‚¬ì¹˜: ê°ê°ì´ ë‚˜ì˜¬ í™•ë¥ ì„ ê³±í•˜ê³ , Nê°œ ì¤‘ 2ê°œë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš°ì˜ ìˆ˜ ê³ ë ¤
                    const prob1 = individualProbs[0];
                    const prob2 = individualProbs[1];
                    // P(ë‘˜ ë‹¤ ë‚˜ì˜´) â‰ˆ C(optionCount, 2) * prob1 * prob2 * (1 - prob1 - prob2)^(optionCount-2)
                    const combinations = (optionCount * (optionCount - 1)) / 2;
                    allMatchProb = combinations * prob1 * prob2 * Math.pow(1 - prob1 - prob2, optionCount - 2);
                    allMatchProb = allMatchProb * 100;
                } else if (selectedDescs.length === 3) {
                    // 3ê°œ ì„ íƒ: Nê°œ ëª¨ë‘ ì„ íƒí•œ ì˜µì…˜ë“¤ì¼ í™•ë¥ 
                    // ê·¼ì‚¬ì¹˜: ê° í™•ë¥ ì˜ ê³±ì— ìˆœì—´ ê³ ë ¤
                    const prob1 = individualProbs[0];
                    const prob2 = individualProbs[1];
                    const prob3 = individualProbs[2];
                    // 3ê°œ ëª¨ë‘ ë‚˜ì˜¬ í™•ë¥  (ìˆœì„œ ë¬´ê´€í•˜ë¯€ë¡œ 3! = 6)
                    if (optionCount >= 3) {
                        allMatchProb = 6 * prob1 * prob2 * prob3 * Math.pow(1 - prob1 - prob2 - prob3, optionCount - 3);
                        allMatchProb = allMatchProb * 100;
                    } else {
                        allMatchProb = 0;
                    }
                }
            }

            // í™•ë¥  ê³„ì‚° ë° í‘œì‹œ
            const previewContainer = document.getElementById('probabilityPreview');
            let html = '';
            
            html += `<div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #667eea;">`;
            html += `<div style="font-weight: 600; color: #333; margin-bottom: 10px;">ê°ì • ì‹œ ì„ íƒí•œ ì˜µì…˜ ë“±ì¥ í™•ë¥ </div>`;
            if (currentItem) {
                html += `<div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">ì•„ì´í…œ: ${currentItem.Name} (ì˜µì…˜ ê°œìˆ˜: ${optionCount}ê°œ)</div>`;
            }
            html += `<div style="margin-bottom: 10px;">`;
            html += `<div style="font-size: 1.3em; font-weight: bold; color: #667eea; margin-bottom: 5px;">ìµœì†Œ 1ê°œ ì´ìƒ: ${atLeastOneMatchProb.toFixed(2)}%</div>`;
            html += `<div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">(${optionCount}ê°œ ì˜µì…˜ ì¤‘ ìµœì†Œ 1ê°œ ì´ìƒ ë§¤ì¹­)</div>`;
            if (selectedDescs.length > 0) {
                html += `<div style="font-size: 1.3em; font-weight: bold; color: #28a745; margin-top: 10px; margin-bottom: 5px;">ëª¨ë‘ ë‚˜ì˜¬ í™•ë¥ : ${allMatchProb.toFixed(4)}%</div>`;
                html += `<div style="font-size: 0.9em; color: #666;">(${optionCount}ê°œ ì˜µì…˜ ì¤‘ ì„ íƒí•œ ${selectedDescs.length}ê°œ ëª¨ë‘ ë§¤ì¹­)</div>`;
            }
            html += `</div>`;
            html += `</div>`;

            for (const desc of selectedDescs) {
                const weight = descWeights[desc];
                const percentage = totalWeight > 0 ? ((weight / totalWeight) * 100).toFixed(2) : 0;
                
                // í•´ë‹¹ Descë¥¼ ê°€ì§„ ì˜µì…˜ë“¤ (í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ì—ì„œë§Œ)
                const options = currentOptionPool.filter(opt => opt.Desc === desc);
                const minValues = options.map(opt => opt.MinValue);
                const maxValues = options.map(opt => opt.MaxValue);
                const overallMin = Math.min(...minValues);
                const overallMax = Math.max(...maxValues);
                
                // ë“±ê¸‰ë³„ ì •ë³´ ìˆ˜ì§‘
                const gradeInfo = {};
                options.forEach(opt => {
                    const gradeText = opt.Grade === 1 ? 'Low' : opt.Grade === 2 ? 'Mid' : 'High';
                    if (!gradeInfo[gradeText]) {
                        gradeInfo[gradeText] = [];
                    }
                    gradeInfo[gradeText].push({
                        min: opt.MinValue,
                        max: opt.MaxValue,
                        weight: opt.Weight
                    });
                });
                
                // ìµœëŒ€ì¹˜ê°€ ë‚˜ì˜¬ í™•ë¥  ê³„ì‚°
                // 1. í•´ë‹¹ ì˜µì…˜ì´ ë‚˜ì˜¬ í™•ë¥ 
                const optionAppearProb = weight / totalWeight;
                
                // 2. ìµœëŒ€ì¹˜ë¥¼ ê°€ì§„ ë“±ê¸‰ ì°¾ê¸°
                let maxGradeOption = null;
                let maxGradeWeight = 0;
                let maxValueInMaxGrade = overallMax;
                
                options.forEach(opt => {
                    if (opt.MaxValue === overallMax) {
                        // ìµœëŒ€ì¹˜ë¥¼ ê°€ì§„ ë“±ê¸‰ ì¤‘ Weightê°€ ê°€ì¥ ë†’ì€ ê²ƒ
                        if (!maxGradeOption || opt.Weight > maxGradeWeight) {
                            maxGradeOption = opt;
                            maxGradeWeight = opt.Weight;
                            maxValueInMaxGrade = opt.MaxValue;
                        }
                    }
                });
                
                // 3. ìµœëŒ€ì¹˜ ë“±ê¸‰ì´ ì„ íƒë  í™•ë¥  (í•´ë‹¹ ë“±ê¸‰ Weight / ì „ì²´ Desc Weight)
                const maxGradeProb = maxGradeOption ? (maxGradeWeight / weight) : 0;
                
                // 4. ìµœëŒ€ê°’ì´ ë‚˜ì˜¬ í™•ë¥  (ìˆ˜ì¹˜ ë²”ìœ„ì—ì„œ ìµœëŒ€ê°’ì´ ë‚˜ì˜¬ í™•ë¥ )
                let maxValueProb = 0;
                if (maxGradeOption) {
                    const minVal = maxGradeOption.MinValue;
                    const maxVal = maxGradeOption.MaxValue;
                    // ì •ìˆ˜ì¸ì§€ ì‹¤ìˆ˜ì¸ì§€ í™•ì¸
                    const isInt = Number.isInteger(minVal) && Number.isInteger(maxVal);
                    if (isInt) {
                        // ì •ìˆ˜: 1 / (max - min + 1)
                        maxValueProb = 1 / (maxVal - minVal + 1);
                    } else {
                        // ì‹¤ìˆ˜: ì—°ì† í™•ë¥  (ë§¤ìš° ì‘ì€ ê°’)
                        maxValueProb = 1 / (maxVal - minVal);
                    }
                }
                
                // 5. ì „ì²´ í™•ë¥ : ì˜µì…˜ ë“±ì¥ í™•ë¥  * ìµœëŒ€ì¹˜ ë“±ê¸‰ ì„ íƒ í™•ë¥  * ìµœëŒ€ê°’ ë‚˜ì˜¬ í™•ë¥ 
                // ê°ì • ì‹œ Nê°œ ì˜µì…˜ì´ ë‚˜ì˜¬ ë•Œ, ì´ ì˜µì…˜ì´ ë‚˜ì˜¤ê³  ìµœëŒ€ì¹˜ê°€ ë‚˜ì˜¬ í™•ë¥ 
                const maxValueOverallProb = optionAppearProb * maxGradeProb * maxValueProb;
                
                // ê°ì • ì‹œ Nê°œ ì˜µì…˜ì´ ë‚˜ì˜¬ ë•Œ ìµœëŒ€ì¹˜ê°€ ë‚˜ì˜¬ í™•ë¥  (ê·¼ì‚¬ì¹˜)
                // P(ìµœëŒ€ì¹˜) â‰ˆ optionCount * maxValueOverallProb * (1 - optionAppearProb)^(optionCount-1)
                // ë” ì •í™•í•˜ê²ŒëŠ”: optionCount * maxValueOverallProb
                const maxValueFinalProb = optionCount * maxValueOverallProb * 100;
                
                let valueRangeText = '';
                let gradeDetails = '';
                
                if (options.length === 1) {
                    // ë‹¨ì¼ ì˜µì…˜
                    valueRangeText = `${overallMin} ~ ${overallMax}${options[0].Type === 'Effect' ? '%' : ''}`;
                } else {
                    // ì—¬ëŸ¬ ë“±ê¸‰ ì˜µì…˜
                    valueRangeText = `ì „ì²´: ${overallMin} ~ ${overallMax}${options[0].Type === 'Effect' ? '%' : ''}`;
                    
                    // ë“±ê¸‰ë³„ ìƒì„¸ ì •ë³´
                    const gradeDetailsList = [];
                    ['Low', 'Mid', 'High'].forEach(grade => {
                        if (gradeInfo[grade] && gradeInfo[grade].length > 0) {
                            const info = gradeInfo[grade][0];
                            const gradeClass = grade === 'Low' ? 'grade-low' : grade === 'Mid' ? 'grade-mid' : 'grade-high';
                            gradeDetailsList.push(
                                `<span class="result-grade ${gradeClass}" style="display: inline-block; margin-right: 5px;">${grade}</span>` +
                                `${info.min}~${info.max}${options[0].Type === 'Effect' ? '%' : ''} (W:${info.weight})`
                            );
                        }
                    });
                    if (gradeDetailsList.length > 0) {
                        gradeDetails = `<div style="margin-top: 8px; line-height: 1.8;">${gradeDetailsList.join('<br>')}</div>`;
                    }
                }
                
                // ì´ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ëª¨ë“  ì•„ì´í…œ ì°¾ê¸°
                const itemsWithThisOption = [];
                EXHIBITION_ITEMS.forEach(item => {
                    const optionIds = item.OptionPool.split(';').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
                    const matchingOptions = OPTION_DATA.filter(opt => 
                        optionIds.includes(opt.ClassID) && opt.Desc === desc
                    );
                    if (matchingOptions.length > 0) {
                        const minVals = matchingOptions.map(opt => opt.MinValue);
                        const maxVals = matchingOptions.map(opt => opt.MaxValue);
                        itemsWithThisOption.push({
                            item: item,
                            options: matchingOptions,
                            min: Math.min(...minVals),
                            max: Math.max(...maxVals)
                        });
                    }
                });
                
                html += `
                    <div class="probability-preview-item">
                        <div class="preview-desc">${desc}</div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span class="preview-weight">Weight: ${weight}</span>
                            <span class="preview-percentage">${percentage}%</span>
                        </div>
                        <div class="preview-detail">
                            <div class="preview-value-range">
                                <strong>ìˆ˜ì¹˜ ë²”ìœ„:</strong> ${valueRangeText}
                                ${gradeDetails}
                            </div>
                            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 3px solid #ffc107;">
                                <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">ìµœëŒ€ì¹˜(${overallMax}${options[0].Type === 'Effect' ? '%' : ''}) ë“±ì¥ í™•ë¥ </div>
                                <div style="font-size: 1.2em; font-weight: bold; color: #ff9800;">${maxValueFinalProb.toFixed(4)}%</div>
                                <div style="font-size: 0.85em; color: #856404; margin-top: 5px;">
                                    (${optionCount}ê°œ ì˜µì…˜ ì¤‘ ì´ ì˜µì…˜ì´ ë‚˜ì˜¤ê³  ìµœëŒ€ì¹˜ê°€ ë‚˜ì˜¬ í™•ë¥ )
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding: 12px; background: #e7f3ff; border-radius: 6px; border-left: 3px solid #667eea;">
                                <div style="font-weight: 600; color: #333; margin-bottom: 10px;">ì´ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œ (${itemsWithThisOption.length}ê°œ)</div>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    ${itemsWithThisOption.map(itemInfo => {
                                        const item = itemInfo.item;
                                        const itemOptions = itemInfo.options;
                                        const itemMin = itemInfo.min;
                                        const itemMax = itemInfo.max;
                                        
                                        // ë“±ê¸‰ë³„ ì •ë³´
                                        const itemGradeInfo = {};
                                        itemOptions.forEach(opt => {
                                            const gradeText = opt.Grade === 1 ? 'Low' : opt.Grade === 2 ? 'Mid' : 'High';
                                            if (!itemGradeInfo[gradeText]) {
                                                itemGradeInfo[gradeText] = [];
                                            }
                                            itemGradeInfo[gradeText].push({
                                                min: opt.MinValue,
                                                max: opt.MaxValue,
                                                weight: opt.Weight
                                            });
                                        });
                                        
                                        const gradeDetailsList = [];
                                        ['Low', 'Mid', 'High'].forEach(grade => {
                                            if (itemGradeInfo[grade] && itemGradeInfo[grade].length > 0) {
                                                const info = itemGradeInfo[grade][0];
                                                const gradeClass = grade === 'Low' ? 'grade-low' : grade === 'Mid' ? 'grade-mid' : 'grade-high';
                                                gradeDetailsList.push(
                                                    `<span class="result-grade ${gradeClass}" style="display: inline-block; margin-right: 5px; font-size: 0.85em;">${grade}</span>` +
                                                    `${info.min}~${info.max}${itemOptions[0].Type === 'Effect' ? '%' : ''}`
                                                );
                                            }
                                        });
                                        
                                        return `
                                            <div style="padding: 8px; margin-bottom: 8px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                                                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${item.Name}</div>
                                                <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                                                    ë²”ìœ„: ${itemMin} ~ ${itemMax}${itemOptions[0].Type === 'Effect' ? '%' : ''} 
                                                    (ì˜µì…˜ ${item.OptionCount}ê°œ, ë¹„ìš©: ${item.cost})
                                                </div>
                                                ${gradeDetailsList.length > 0 ? `<div style="font-size: 0.85em; color: #666;">${gradeDetailsList.join(' | ')}</div>` : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            <div class="preview-weight-desc" style="margin-top: 10px;">
                                <strong>ê°€ì¤‘ì¹˜ ì„¤ëª…:</strong> Weightê°€ ë†’ì„ìˆ˜ë¡ í•´ë‹¹ ì˜µì…˜ì´ ë” ìì£¼ ë“±ì¥í•©ë‹ˆë‹¤. 
                                í˜„ì¬ Weight ${weight}ëŠ” ì „ì²´ Weight ${totalWeight} ì¤‘ ${percentage}%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>
                `;
            }

            previewContainer.innerHTML = html;

            return { descWeights, totalWeight, selectedDescs, atLeastOneMatchProb };
        }

        // ì „ì²´ ì˜µì…˜ í’€ì—ì„œ í™•ë¥  ê³„ì‚° (ê°ì • ì‹œ Nê°œ ì˜µì…˜ì´ ë‚˜ì˜¬ ë•Œ)
        function calculateEnchantProbability(selectedDescs) {
            if (selectedDescs.length === 0) return null;

            // í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ ì‚¬ìš©
            const currentOptionPool = getCurrentItemOptionPool();
            const currentItem = getCurrentItem();
            const optionCount = currentItem ? currentItem.OptionCount : 3;

            // ì˜µì…˜ í’€ êµ¬ì„±
            const allOptions = [];
            currentOptionPool.forEach(opt => {
                if (opt.Weight > 0) {
                    allOptions.push({
                        id: opt.ClassID,
                        cls: opt,
                        weight: opt.Weight
                    });
                }
            });

            // ì „ì²´ Weight í•©ê³„
            const totalWeight = allOptions.reduce((sum, opt) => sum + opt.weight, 0);

            // ì„ íƒí•œ ì˜µì…˜ë“¤ì˜ Weight í•©ê³„
            const selectedWeights = {};
            for (const desc of selectedDescs) {
                const options = OPTION_DATA.filter(opt => opt.Desc === desc);
                const totalDescWeight = options.reduce((sum, opt) => sum + opt.Weight, 0);
                selectedWeights[desc] = totalDescWeight;
            }

            const totalSelectedWeight = Object.values(selectedWeights).reduce((sum, w) => sum + w, 0);

            // ê°ì • ì‹œ Nê°œ ì˜µì…˜ì´ ë‚˜ì˜¬ ë•Œ, ì„ íƒí•œ ì˜µì…˜ì´ í•˜ë‚˜ë¼ë„ í¬í•¨ë  í™•ë¥  ê³„ì‚°
            // ì´ëŠ” ë³µì¡í•œ ì¡°í•© í™•ë¥ ì´ë¯€ë¡œ ê·¼ì‚¬ì¹˜ë¡œ ê³„ì‚°
            // P(ìµœì†Œ 1ê°œ ë§¤ì¹­) = 1 - P(ëª¨ë‘ ë§¤ì¹­ ì•ˆë¨)
            // P(ëª¨ë‘ ë§¤ì¹­ ì•ˆë¨) â‰ˆ ((totalWeight - totalSelectedWeight) / totalWeight)^optionCount
            const noMatchProb = Math.pow((totalWeight - totalSelectedWeight) / totalWeight, optionCount);
            const atLeastOneMatchProb = (1 - noMatchProb) * 100;

            return {
                totalWeight: totalWeight,
                selectedWeights: selectedWeights,
                totalSelectedWeight: totalSelectedWeight,
                atLeastOneMatchProb: atLeastOneMatchProb.toFixed(2),
                eachDescProb: {},
                optionCount: optionCount
            };
        }

        // ì˜µì…˜ ë¡¤ë§ í•¨ìˆ˜ (ê°ì •í•˜ê¸°)
        function rollOptions() {
            // í˜„ì¬ ì•„ì´í…œ í™•ì¸
            const currentItem = getCurrentItem();
            if (!currentItem) {
                alert('ì „ì‹œ ì•„ì´í…œì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì„ íƒëœ ì˜µì…˜ Desc ê°€ì ¸ì˜¤ê¸°
            const selectedDescs = [];
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                const selectedDesc = select.value;
                if (selectedDesc && selectedDesc !== '') {
                    selectedDescs.push(selectedDesc);
                }
            }

            // í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ êµ¬ì„±
            const currentOptionPool = getCurrentItemOptionPool();
            const allOptionPool = [];
            currentOptionPool.forEach(opt => {
                if (opt.Weight > 0) {
                    allOptionPool.push({
                        id: opt.ClassID,
                        cls: opt,
                        weight: opt.Weight
                    });
                }
            });

            if (allOptionPool.length === 0) {
                alert('ìœ íš¨í•œ ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ê°ì • ê²°ê³¼: OptionCountë§Œí¼ ì˜µì…˜ ë½‘ê¸°
            const optionCount = currentItem.OptionCount;
            const enchantResults = calcWeightBaseRandom(allOptionPool, optionCount);

            // ì„ íƒí•œ ì˜µì…˜ê³¼ ë§¤ì¹­ í™•ì¸
            const matchedOptions = [];
            const matchedDescs = new Set();
            
            enchantResults.forEach(([id, value]) => {
                const option = OPTION_DATA.find(opt => opt.ClassID === id);
                if (option && selectedDescs.includes(option.Desc)) {
                    matchedOptions.push({ id, value, option });
                    matchedDescs.add(option.Desc);
                }
            });

            // í™•ë¥  ê³„ì‚°
            const probInfo = calculateEnchantProbability(selectedDescs);

            // í†µê³„ ì—…ë°ì´íŠ¸
            stats.totalRolls++;
            enchantResults.forEach(([id, value]) => {
                if (!stats.optionCounts[id]) {
                    stats.optionCounts[id] = 0;
                    stats.optionValueSum[id] = 0;
                    stats.optionValueCount[id] = 0;
                }
                stats.optionCounts[id]++;
                stats.optionValueSum[id] += value;
                stats.optionValueCount[id]++;
            });

            // ê²°ê³¼ í‘œì‹œ
            displayEnchantResults(enchantResults, selectedDescs, matchedOptions, matchedDescs, probInfo);
            updateStats();
            updateProbabilityChart();

            // ìë™ ê°ì • ì¤‘ì´ë©´ ì„ íƒí•œ ì˜µì…˜ì´ ëª¨ë‘ ë‚˜ì™”ëŠ”ì§€ í™•ì¸
            if (isAutoEnchanting) {
                autoEnchantCount++;
                document.getElementById('autoEnchantCount').textContent = autoEnchantCount;

                // ì„ íƒí•œ ì˜µì…˜ì´ ëª¨ë‘ ë‚˜ì™”ëŠ”ì§€ í™•ì¸
                if (selectedDescs.length > 0 && matchedDescs.size >= selectedDescs.length) {
                    // ëª¨ë“  ì„ íƒí•œ ì˜µì…˜ì´ ë‚˜ì™”ìœ¼ë©´ ìë™ ê°ì • ì¤‘ì§€
                    stopAutoEnchant();
                    alert(`ì„±ê³µ! ${autoEnchantCount}íšŒ ë§Œì— ì›í•˜ëŠ” ì˜µì…˜ì´ ëª¨ë‘ ë‚˜ì™”ìŠµë‹ˆë‹¤!`);
                }
            }

            // ìë™ ê°ì • ê²°ê³¼ ë°˜í™˜ (ëª¨ë“  ì˜µì…˜ì´ ë‚˜ì™”ëŠ”ì§€ ì—¬ë¶€)
            return {
                allMatched: selectedDescs.length > 0 && matchedDescs.size >= selectedDescs.length,
                matchedCount: matchedDescs.size,
                selectedCount: selectedDescs.length
            };
        }

        // ìë™ ê°ì • í† ê¸€
        function toggleAutoEnchant() {
            // ì„ íƒí•œ ì˜µì…˜ì´ ìˆëŠ”ì§€ í™•ì¸
            const selectedDescs = [];
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                const selectedDesc = select.value;
                if (selectedDesc && selectedDesc !== '') {
                    selectedDescs.push(selectedDesc);
                }
            }

            if (selectedDescs.length === 0) {
                alert('ìë™ ê°ì •ì„ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (isAutoEnchanting) {
                stopAutoEnchant();
            } else {
                startAutoEnchant();
            }
        }

        // ìë™ ê°ì • ì‹œì‘
        function startAutoEnchant() {
            isAutoEnchanting = true;
            autoEnchantCount = 0;
            
            const autoBtn = document.getElementById('autoEnchantBtn');
            const enchantBtn = document.getElementById('enchantBtn');
            const statusDiv = document.getElementById('autoEnchantStatus');
            
            autoBtn.textContent = 'â¹ï¸ ìë™ ê°ì • ì¤‘ì§€';
            autoBtn.className = 'btn-secondary btn-large';
            enchantBtn.disabled = true;
            statusDiv.style.display = 'block';
            document.getElementById('autoEnchantCount').textContent = '0';

            // ìë™ ê°ì • ì‹¤í–‰ (ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ë‘ê³  ë°˜ë³µ)
            autoEnchantInterval = setInterval(() => {
                if (!isAutoEnchanting) {
                    clearInterval(autoEnchantInterval);
                    return;
                }
                rollOptions();
            }, 100); // 100msë§ˆë‹¤ ì‹¤í–‰ (ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜)
        }

        // ìë™ ê°ì • ì¤‘ì§€
        function stopAutoEnchant() {
            isAutoEnchanting = false;
            
            if (autoEnchantInterval) {
                clearInterval(autoEnchantInterval);
                autoEnchantInterval = null;
            }

            const autoBtn = document.getElementById('autoEnchantBtn');
            const enchantBtn = document.getElementById('enchantBtn');
            const statusDiv = document.getElementById('autoEnchantStatus');
            
            autoBtn.textContent = 'ğŸ”„ ìë™ ê°ì •';
            autoBtn.className = 'btn-secondary btn-large';
            enchantBtn.disabled = false;
            statusDiv.style.display = 'none';
        }

        // ê°ì • ê²°ê³¼ í‘œì‹œ
        function displayEnchantResults(results, selectedDescs, matchedOptions, matchedDescs, probInfo) {
            const resultSection = document.getElementById('resultSection');
            const resultsContainer = document.getElementById('enchantResults');
            const matchInfoContainer = document.getElementById('matchInfo');

            resultSection.style.display = 'block';

            // ê°ì • ê²°ê³¼ 3ê°œ í‘œì‹œ
            let html = '';
            results.forEach(([id, value]) => {
                const option = OPTION_DATA.find(opt => opt.ClassID === id);
                if (!option) return;

                const gradeClass = option.Grade === 1 ? 'grade-low' : option.Grade === 2 ? 'grade-mid' : 'grade-high';
                const gradeText = option.Grade === 1 ? 'Low' : option.Grade === 2 ? 'Mid' : 'High';
                const isMatched = selectedDescs.includes(option.Desc);
                const matchClass = isMatched ? 'matched' : '';

                html += `<div class="enchant-result-item ${matchClass}">`;
                html += `<div style="font-weight: 600; color: #333; margin-bottom: 8px; font-size: 1.1em;">${option.Desc}</div>`;
                html += `<div style="font-size: 1.5em; font-weight: bold; color: #667eea; margin-bottom: 8px;">${value}${option.Type === 'Effect' ? '%' : ''}</div>`;
                html += `<div style="margin-bottom: 5px;"><span class="result-grade ${gradeClass}">${gradeText}</span></div>`;
                if (isMatched) {
                    html += `<div style="color: #28a745; font-weight: 600; margin-top: 8px;">âœ“ ì›í•˜ëŠ” ì˜µì…˜!</div>`;
                }
                html += `</div>`;
            });
            resultsContainer.innerHTML = html;

            // ë§¤ì¹­ ì •ë³´ í‘œì‹œ
            let matchHtml = '<h3>ë§¤ì¹­ ê²°ê³¼</h3>';
            matchHtml += `<div style="margin-bottom: 15px;">`;
            matchHtml += `<strong>ì„ íƒí•œ ì˜µì…˜:</strong> ${selectedDescs.length > 0 ? selectedDescs.join(', ') : 'ì—†ìŒ'}<br>`;
            matchHtml += `<strong>ë§¤ì¹­ëœ ì˜µì…˜:</strong> ${matchedDescs.size}ê°œ (${Array.from(matchedDescs).join(', ') || 'ì—†ìŒ'})`;
            matchHtml += `</div>`;

            if (probInfo) {
                const optionCount = probInfo.optionCount || 3;
                matchHtml += `<div class="match-stats">`;
                matchHtml += `<div class="match-stat-item">`;
                matchHtml += `<div class="match-stat-label">ì„ íƒí•œ ì˜µì…˜ ë“±ì¥ í™•ë¥ </div>`;
                matchHtml += `<div class="match-stat-value">${probInfo.atLeastOneMatchProb}%</div>`;
                matchHtml += `</div>`;
                matchHtml += `<div class="match-stat-item">`;
                matchHtml += `<div class="match-stat-label">ë§¤ì¹­ëœ ì˜µì…˜ ìˆ˜</div>`;
                matchHtml += `<div class="match-stat-value">${matchedDescs.size}/${optionCount}</div>`;
                matchHtml += `</div>`;
                matchHtml += `</div>`;
            }

            matchInfoContainer.innerHTML = matchHtml;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalRolls').textContent = stats.totalRolls;
            
            const totalOptions = Object.values(stats.optionCounts).reduce((sum, count) => sum + count, 0);
            document.getElementById('totalOptions').textContent = totalOptions;
            
            const uniqueOptions = Object.keys(stats.optionCounts).length;
            document.getElementById('uniqueOptions').textContent = uniqueOptions;
        }

        // í™•ë¥  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateProbabilityChart() {
            const chartContainer = document.getElementById('chartContainer');
            const probabilityChart = document.getElementById('probabilityChart');
            
            if (stats.totalRolls === 0) {
                probabilityChart.style.display = 'none';
                return;
            }

            probabilityChart.style.display = 'block';
            
            const totalOptions = Object.values(stats.optionCounts).reduce((sum, count) => sum + count, 0);
            
            // ì˜µì…˜ë³„ í†µê³„ ì •ë ¬ (ë“±ì¥ íšŸìˆ˜ ìˆœ)
            const sortedOptions = Object.entries(stats.optionCounts)
                .map(([id, count]) => {
                    const option = OPTION_DATA.find(opt => opt.ClassID === parseInt(id));
                    const percentage = (count / totalOptions * 100).toFixed(2);
                    const avgValue = stats.optionValueCount[id] > 0 
                        ? (stats.optionValueSum[id] / stats.optionValueCount[id]).toFixed(2)
                        : '0';
                    
                    return {
                        id: parseInt(id),
                        option: option,
                        count: count,
                        percentage: parseFloat(percentage),
                        avgValue: avgValue
                    };
                })
                .filter(item => item.option)
                .sort((a, b) => b.count - a.count);

            chartContainer.innerHTML = sortedOptions.map(item => {
                const gradeClass = item.option.Grade === 1 ? 'grade-low' : item.option.Grade === 2 ? 'grade-mid' : 'grade-high';
                const gradeText = item.option.Grade === 1 ? 'Low' : item.option.Grade === 2 ? 'Mid' : 'High';
                
                return `
                    <div class="chart-item">
                        <div class="chart-label">
                            ${item.option.Desc}
                            <span class="result-grade ${gradeClass}" style="margin-left: 10px; font-size: 0.8em;">${gradeText}</span>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-bar" style="width: ${item.percentage}%">
                                ${item.percentage > 5 ? item.percentage + '%' : ''}
                            </div>
                        </div>
                        <div class="chart-percentage">
                            ${item.count}íšŒ (${item.percentage}%)
                        </div>
                        <div style="min-width: 100px; text-align: right; color: #666; font-size: 0.9em;">
                            í‰ê· : ${item.avgValue}${item.option.Type === 'Effect' ? '%' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // í†µê³„ ì´ˆê¸°í™”
        function resetStats() {
            if (confirm('ëª¨ë“  í†µê³„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                stats = {
                    totalRolls: 0,
                    optionCounts: {},
                    optionValueSum: {},
                    optionValueCount: {}
                };
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6m0 4h.01"/>
                        </svg>
                        <p>ì˜µì…˜ì„ ë½‘ì•„ë³´ì„¸ìš”!</p>
                    </div>
                `;
                updateStats();
                document.getElementById('probabilityChart').style.display = 'none';
            }
        }

        // ì „ì‹œ ì•„ì´í…œ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initializeExhibitionItems() {
            const itemSelect = document.getElementById('exhibitionItem');
            
            EXHIBITION_ITEMS.forEach(item => {
                const option = document.createElement('option');
                option.value = item.ClassID.toString();
                option.textContent = `${item.Name} (ë¹„ìš©: ${item.cost}, ì˜µì…˜: ${item.OptionCount}ê°œ)`;
                itemSelect.appendChild(option);
            });
            
            // ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            itemSelect.addEventListener('change', function() {
                updateOptionSelects();
                updateAvailableOptionsList();
                calculateProbabilities();
            });
        }

        // ì•„ì´í…œë³„ ë“±ì¥ ê°€ëŠ¥í•œ ì˜µì…˜ ëª©ë¡ í‘œì‹œ
        function updateAvailableOptionsList() {
            const container = document.getElementById('availableOptionsList');
            const currentItem = getCurrentItem();
            
            if (!currentItem) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ì „ì‹œ ì•„ì´í…œì„ ì„ íƒí•˜ë©´ ë“±ì¥ ê°€ëŠ¥í•œ ì˜µì…˜ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>';
                return;
            }
            
            const currentOptionPool = getCurrentItemOptionPool();
            
            if (currentOptionPool.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ë“±ì¥ ê°€ëŠ¥í•œ ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            // Descë³„ë¡œ ê·¸ë£¹í™”
            const optionsByDesc = {};
            currentOptionPool.forEach(opt => {
                if (!optionsByDesc[opt.Desc]) {
                    optionsByDesc[opt.Desc] = [];
                }
                optionsByDesc[opt.Desc].push(opt);
            });
            
            // Descë³„ë¡œ ì •ë ¬
            const sortedDescs = Object.keys(optionsByDesc).sort();
            
            let html = '';
            html += `<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;">`;
            html += `<div style="font-weight: 600; color: #333; margin-bottom: 10px;">ì´ ${currentOptionPool.length}ê°œì˜ ì˜µì…˜ (${sortedDescs.length}ì¢…ë¥˜)</div>`;
            html += `</div>`;
            
            sortedDescs.forEach(desc => {
                const options = optionsByDesc[desc];
                const firstOption = options[0];
                
                // ë“±ê¸‰ë³„ ì •ë³´ ìˆ˜ì§‘
                const gradeInfo = {};
                options.forEach(opt => {
                    const gradeText = opt.Grade === 1 ? 'Low' : opt.Grade === 2 ? 'Mid' : 'High';
                    if (!gradeInfo[gradeText]) {
                        gradeInfo[gradeText] = [];
                    }
                    gradeInfo[gradeText].push({
                        min: opt.MinValue,
                        max: opt.MaxValue,
                        weight: opt.Weight
                    });
                });
                
                // ì „ì²´ ìˆ˜ì¹˜ ë²”ìœ„
                const minValues = options.map(opt => opt.MinValue);
                const maxValues = options.map(opt => opt.MaxValue);
                const overallMin = Math.min(...minValues);
                const overallMax = Math.max(...maxValues);
                
                // Weight í•©ê³„
                const totalWeight = options.reduce((sum, opt) => sum + opt.Weight, 0);
                
                html += `<div class="probability-preview-item">`;
                html += `<div class="preview-desc">${desc}</div>`;
                html += `<div style="display: flex; align-items: center; gap: 15px;">`;
                html += `<span class="preview-weight">Weight: ${totalWeight}</span>`;
                html += `<span class="preview-percentage">${options.length}ê°œ ë“±ê¸‰</span>`;
                html += `</div>`;
                html += `<div class="preview-detail">`;
                html += `<div class="preview-value-range">`;
                html += `<strong>ìˆ˜ì¹˜ ë²”ìœ„:</strong> ${overallMin} ~ ${overallMax}${firstOption.Type === 'Effect' ? '%' : ''}`;
                
                // ë“±ê¸‰ë³„ ìƒì„¸ ì •ë³´
                const gradeDetailsList = [];
                ['Low', 'Mid', 'High'].forEach(grade => {
                    if (gradeInfo[grade] && gradeInfo[grade].length > 0) {
                        const info = gradeInfo[grade][0];
                        const gradeClass = grade === 'Low' ? 'grade-low' : grade === 'Mid' ? 'grade-mid' : 'grade-high';
                        gradeDetailsList.push(
                            `<span class="result-grade ${gradeClass}" style="display: inline-block; margin-right: 5px; margin-top: 5px;">${grade}</span>` +
                            `${info.min}~${info.max}${firstOption.Type === 'Effect' ? '%' : ''} (W:${info.weight})`
                        );
                    }
                });
                if (gradeDetailsList.length > 0) {
                    html += `<div style="margin-top: 8px; line-height: 1.8;">${gradeDetailsList.join('<br>')}</div>`;
                }
                
                html += `</div>`;
                html += `</div>`;
                html += `</div>`;
            });
            
            container.innerHTML = html;
        }

        // ì˜µì…˜ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸
        function initializeOptionSelects() {
            updateOptionSelects();
        }

        // í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ì— ë§ê²Œ ì˜µì…˜ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateOptionSelects() {
            const currentItem = getCurrentItem();
            
            // ì•„ì´í…œì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì „ì²´ ì˜µì…˜ ëª©ë¡ í‘œì‹œ
            let availableDescs = [];
            if (!currentItem) {
                // ì „ì²´ ì˜µì…˜ ëª©ë¡ì—ì„œ Descë§Œ ê°€ì ¸ì˜¤ê¸° (ì¤‘ë³µ ì œê±°)
                availableDescs = [...new Set(OPTION_DATA.map(opt => opt.Desc))].sort();
            } else {
                // í˜„ì¬ ì•„ì´í…œì˜ ì˜µì…˜ í’€ì— ìˆëŠ” ì˜µì…˜ë“¤ì˜ Descë§Œ ê°€ì ¸ì˜¤ê¸° (ì¤‘ë³µ ì œê±°)
                const currentOptionPool = getCurrentItemOptionPool();
                availableDescs = [...new Set(currentOptionPool.map(opt => opt.Desc))].sort();
            }
            
            // ê° ë“œë¡­ë‹¤ìš´ì— ì˜µì…˜ ì¶”ê°€
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                const currentValue = select.value; // í˜„ì¬ ì„ íƒëœ ê°’ ì €ì¥
                
                // ê¸°ì¡´ ì˜µì…˜ ìœ ì§€ (ì²« ë²ˆì§¸ "-- ì„ íƒ ì•ˆí•¨ --" ì˜µì…˜)
                const firstOption = select.options[0];
                select.innerHTML = '';
                select.appendChild(firstOption);
                
                // ì˜µì…˜ ì¶”ê°€
                availableDescs.forEach(desc => {
                    const option = document.createElement('option');
                    option.value = desc;
                    option.textContent = desc;
                    select.appendChild(option);
                });
                
                // ì´ì „ì— ì„ íƒí•œ ê°’ì´ ì—¬ì „íˆ ìœ íš¨í•˜ë©´ ë³µì›
                if (currentValue && availableDescs.includes(currentValue)) {
                    select.value = currentValue;
                } else {
                    select.value = '';
                }
                
                // ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (í™•ë¥  ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸)
                // ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¤‘ë³µ ë°©ì§€
                const existingListeners = select.getAttribute('data-listener-added');
                if (!existingListeners) {
                    select.addEventListener('change', function() {
                        updateOptionCountMax();
                        updateSelectedOptionsItemsList();
                        calculateProbabilities();
                    });
                    select.setAttribute('data-listener-added', 'true');
                }
            }
        }

        // ì„ íƒí•œ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œ ëª©ë¡ í‘œì‹œ
        function updateSelectedOptionsItemsList() {
            const container = document.getElementById('selectedOptionsItemsList');
            
            // ì„ íƒëœ ì˜µì…˜ Desc ê°€ì ¸ì˜¤ê¸°
            const selectedDescs = [];
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                const selectedDesc = select.value;
                if (selectedDesc && selectedDesc !== '') {
                    selectedDescs.push(selectedDesc);
                }
            }

            if (selectedDescs.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ì˜µì…˜ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>';
                return;
            }

            let html = '';
            
            // ê° ì„ íƒí•œ ì˜µì…˜ì— ëŒ€í•´ ì•„ì´í…œ ëª©ë¡ í‘œì‹œ
            selectedDescs.forEach((desc, index) => {
                // ì´ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ëª¨ë“  ì•„ì´í…œ ì°¾ê¸°
                const itemsWithThisOption = [];
                EXHIBITION_ITEMS.forEach(item => {
                    const optionIds = item.OptionPool.split(';').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
                    const matchingOptions = OPTION_DATA.filter(opt => 
                        optionIds.includes(opt.ClassID) && opt.Desc === desc
                    );
                    if (matchingOptions.length > 0) {
                        const minVals = matchingOptions.map(opt => opt.MinValue);
                        const maxVals = matchingOptions.map(opt => opt.MaxValue);
                        itemsWithThisOption.push({
                            item: item,
                            options: matchingOptions,
                            min: Math.min(...minVals),
                            max: Math.max(...maxVals)
                        });
                    }
                });

                if (itemsWithThisOption.length === 0) {
                    html += `
                        <div class="probability-preview-item" style="margin-bottom: 15px;">
                            <div class="preview-desc" style="font-size: 1.1em; margin-bottom: 10px;">${desc}</div>
                            <div style="padding: 15px; background: #f8d7da; border-radius: 6px; border-left: 3px solid #dc3545;">
                                <div style="color: #721c24; font-weight: 600;">ì´ ì˜µì…˜ì´ ë“±ì¥í•˜ëŠ” ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            </div>
                        </div>
                    `;
                    return;
                }

                html += `
                    <div class="probability-preview-item" style="margin-bottom: 15px;">
                        <div class="preview-desc" style="font-size: 1.1em; margin-bottom: 10px;">${desc}</div>
                        <div style="padding: 12px; background: #e7f3ff; border-radius: 6px; border-left: 3px solid #667eea; margin-bottom: 10px;">
                            <div style="font-weight: 600; color: #333; margin-bottom: 10px;">ë“±ì¥ ì•„ì´í…œ: ${itemsWithThisOption.length}ê°œ</div>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${itemsWithThisOption.map(itemInfo => {
                                    const item = itemInfo.item;
                                    const itemOptions = itemInfo.options;
                                    const itemMin = itemInfo.min;
                                    const itemMax = itemInfo.max;
                                    
                                    // ë“±ê¸‰ë³„ ì •ë³´
                                    const itemGradeInfo = {};
                                    itemOptions.forEach(opt => {
                                        const gradeText = opt.Grade === 1 ? 'Low' : opt.Grade === 2 ? 'Mid' : 'High';
                                        if (!itemGradeInfo[gradeText]) {
                                            itemGradeInfo[gradeText] = [];
                                        }
                                        itemGradeInfo[gradeText].push({
                                            min: opt.MinValue,
                                            max: opt.MaxValue,
                                            weight: opt.Weight
                                        });
                                    });
                                    
                                    const gradeDetailsList = [];
                                    ['Low', 'Mid', 'High'].forEach(grade => {
                                        if (itemGradeInfo[grade] && itemGradeInfo[grade].length > 0) {
                                            const info = itemGradeInfo[grade][0];
                                            const gradeClass = grade === 'Low' ? 'grade-low' : grade === 'Mid' ? 'grade-mid' : 'grade-high';
                                            gradeDetailsList.push(
                                                `<span class="result-grade ${gradeClass}" style="display: inline-block; margin-right: 5px; font-size: 0.85em;">${grade}</span>` +
                                                `${info.min}~${info.max}${itemOptions[0].Type === 'Effect' ? '%' : ''} (W:${info.weight})`
                                            );
                                        }
                                    });
                                    
                                    return `
                                        <div style="padding: 10px; margin-bottom: 8px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                                            <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${item.Name}</div>
                                            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                                                <strong>ìˆ˜ì¹˜ ë²”ìœ„:</strong> ${itemMin} ~ ${itemMax}${itemOptions[0].Type === 'Effect' ? '%' : ''} 
                                                | ì˜µì…˜ ${item.OptionCount}ê°œ | ë¹„ìš©: ${item.cost}
                                            </div>
                                            ${gradeDetailsList.length > 0 ? `<div style="font-size: 0.85em; color: #666; margin-top: 5px;">${gradeDetailsList.join(' | ')}</div>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // ì„ íƒëœ ì˜µì…˜ ê°œìˆ˜ì— ë”°ë¼ ë½‘ì„ ì˜µì…˜ ê°œìˆ˜ ìµœëŒ€ê°’ ì¡°ì • (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€)
        function updateOptionCountMax() {
            // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
        }

        // ì„ íƒëœ ì˜µì…˜ ê°œìˆ˜ ë°˜í™˜
        function getSelectedOptionCount() {
            let count = 0;
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById(`optionPool${i}`);
                if (select.value && select.value !== '') {
                    count++;
                }
            }
            return count;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', function() {
            initializeExhibitionItems();
            initializeOptionSelects();
            updateAvailableOptionsList();
            updateSelectedOptionsItemsList();
            updateOptionCountMax();
            calculateProbabilities();
        });

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

